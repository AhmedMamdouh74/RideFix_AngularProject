<div class="admin-dashboard" dir="rtl">
  <!-- Header Section -->
  <div class="dashboard-header">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-md-8">
          <h1 class="dashboard-title">
            <i class="fas fa-tachometer-alt"></i>
            لوحة تحكم الإدارة
          </h1>
          <p class="dashboard-subtitle">مرحباً بك في لوحة تحكم نظام RideFix</p>
        </div>
        <div class="col-md-4 text-md-end">
          <div class="current-time">
            <i class="fas fa-clock"></i>
            <span>{{ currentDate | date:'EEEE, MMMM d, y' }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="container mt-4">
    <div class="row g-4">
      <!-- Total Technicians Card -->
      <div class="col-lg-3 col-md-6">
        <div class="stat-card technicians-card">
          <div class="stat-card-icon">
            <i class="fas fa-tools"></i>
          </div>
          <div class="stat-card-content">
            <h3 class="stat-number">{{ dashboardStats?.users?.technicians?.count || 0 }}</h3>
            <p class="stat-label">إجمالي الفنيين</p>
            <small class="stat-percent">{{ dashboardStats?.users?.technicians?.percent || 0 }}%</small>
          </div>
          <div class="stat-card-bg"></div>
        </div>
      </div>

      <!-- Total Car Owners Card -->
      <div class="col-lg-3 col-md-6">
        <div class="stat-card car-owners-card">
          <div class="stat-card-icon">
            <i class="fas fa-car"></i>
          </div>
          <div class="stat-card-content">
            <h3 class="stat-number">{{ dashboardStats?.users?.carOwners?.count || 0 }}</h3>
            <p class="stat-label">إجمالي أصحاب السيارات</p>
            <small class="stat-percent">{{ dashboardStats?.users?.carOwners?.percent || 0 }}%</small>
          </div>
          <div class="stat-card-bg"></div>
        </div>
      </div>

      <!-- Total Requests Card -->
      <div class="col-lg-3 col-md-6">
        <div class="stat-card requests-card">
          <div class="stat-card-icon">
            <i class="fas fa-clipboard-list"></i>
          </div>
          <div class="stat-card-content">
            <h3 class="stat-number">{{ (dashboardStats?.requests?.completed?.count || 0) + (dashboardStats?.requests?.waiting?.count || 0) + (dashboardStats?.requests?.active?.count || 0) + (dashboardStats?.requests?.canceled?.count || 0) }}</h3>
            <p class="stat-label">إجمالي الطلبات</p>
          </div>
          <div class="stat-card-bg"></div>
        </div>
      </div>

      <!-- Active Requests Card -->
      <div class="col-lg-3 col-md-6">
        <div class="stat-card active-requests-card">
          <div class="stat-card-icon">
            <i class="fas fa-clock"></i>
          </div>
          <div class="stat-card-content">
            <h3 class="stat-number">{{ dashboardStats?.requests?.active?.count || 0 }}</h3>
            <p class="stat-label">الطلبات النشطة</p>
            <small class="stat-percent">{{ dashboardStats?.requests?.active?.percent || 0 }}%</small>
          </div>
          <div class="stat-card-bg"></div>
        </div>
      </div>

      
    </div>

    <!-- Performance Section -->
    <div class="row mt-5">
      <div class="col-12">
        <h2 class="section-title">
          <i class="fas fa-chart-line"></i>
          أداء النظام
        </h2>
      </div>
    </div>

    <div class="row g-4">
      <!-- User Growth -->
      <div class="col-lg-6">
        <div class="performance-card">
          <div class="performance-header">
            <h3><i class="fas fa-users"></i> نمو المستخدمين</h3>
          </div>
          <div class="performance-content">
            <div class="growth-stats">
              <div class="growth-item">
                <span class="growth-label">هذا الشهر:</span>
                <span class="growth-value positive">{{ dashboardStats?.users?.growth?.thisMonth || 0 }}</span>
              </div>
              <div class="growth-item">
                <span class="growth-label">الشهر الماضي:</span>
                <span class="growth-value">{{ dashboardStats?.users?.growth?.lastMonth || 0 }}</span>
              </div>
              <div class="growth-item">
                <span class="growth-label">نسبة النمو:</span>
                <span class="growth-value positive">{{ dashboardStats?.users?.growth?.difference || 0 }}%</span>
              </div>
              <div class="growth-item">
                <span class="growth-label">معدل التقييم:</span>
                <span class="growth-value">{{ dashboardStats?.users?.rates || 0 }}/5</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Request Status -->
      <div class="col-lg-6">
        <div class="performance-card">
          <div class="performance-header">
            <h3><i class="fas fa-clipboard-check"></i> حالة الطلبات</h3>
          </div>
          <div class="performance-content">
            <div class="request-stats">
              <div class="request-item completed">
                <span class="request-label">مكتملة:</span>
                <span class="request-value">{{ dashboardStats?.requests?.completed?.count || 0 }}</span>
                <span class="request-percent">({{ dashboardStats?.requests?.completed?.percent || 0 }}%)</span>
              </div>
              <div class="request-item waiting">
                <span class="request-label">قيد الانتظار:</span>
                <span class="request-value">{{ dashboardStats?.requests?.waiting?.count || 0 }}</span>
                <span class="request-percent">({{ dashboardStats?.requests?.waiting?.percent || 0 }}%)</span>
              </div>
              <div class="request-item active">
                <span class="request-label">نشطة:</span>
                <span class="request-value">{{ dashboardStats?.requests?.active?.count || 0 }}</span>
                <span class="request-percent">({{ dashboardStats?.requests?.active?.percent || 0 }}%)</span>
              </div>
              <div class="request-item canceled">
                <span class="request-label">ملغية:</span>
                <span class="request-value">{{ dashboardStats?.requests?.canceled?.count || 0 }}</span>
                <span class="request-percent">({{ dashboardStats?.requests?.canceled?.percent || 0 }}%)</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions Section -->
    <div class="row mt-5">
      <div class="col-12">
        <h2 class="section-title">
          <i class="fas fa-bolt"></i>
          إجراءات سريعة
        </h2>
      </div>
    </div>

    <div class="row g-4">
      <!-- Manage Technicians -->
      <div class="col-lg-4 col-md-6">
        <div class="quick-action-card technicians-action">
          <div class="action-icon">
            <i class="fas fa-tools"></i>
          </div>
          <div class="action-content">
            <h3>إدارة الفنيين</h3>
            <p>عرض وتعديل بيانات الفنيين المسجلين في النظام</p>
            <a routerLink="/admin/technicians" class="btn btn-primary">
              <i class="fas fa-arrow-left"></i>
              إدارة الفنيين
            </a>
          </div>
        </div>
      </div>

      <!-- Manage Car Owners -->
      <div class="col-lg-4 col-md-6">
        <div class="quick-action-card car-owners-action">
          <div class="action-icon">
            <i class="fas fa-car"></i>
          </div>
          <div class="action-content">
            <h3>إدارة أصحاب السيارات</h3>
            <p>عرض وتعديل بيانات أصحاب السيارات المسجلين</p>
            <a routerLink="/admin/car-owners" class="btn btn-primary">
              <i class="fas fa-arrow-left"></i>
              إدارة أصحاب السيارات
            </a>
          </div>
        </div>
      </div>

      <!-- View Statistics -->
      <div class="col-lg-4 col-md-6">
        <div class="quick-action-card statistics-action">
          <div class="action-icon">
            <i class="fas fa-chart-bar"></i>
          </div>
          <div class="action-content">
            <h3>عرض الإحصائيات</h3>
            <p>مراجعة الإحصائيات التفصيلية والتقارير</p>
            <a routerLink="/admin/statistics" class="btn btn-primary">
              <i class="fas fa-arrow-left"></i>
              عرض الإحصائيات
            </a>
          </div>
        </div>
      </div>

              <!-- Manage Reports -->
        <div class="col-lg-4 col-md-6">
          <div class="quick-action-card reports-action">
            <div class="action-icon">
              <i class="fas fa-flag"></i>
            </div>
            <div class="action-content">
              <h3>إدارة البلاغات</h3>
              <p>مراجعة وإدارة البلاغات المقدمة من المستخدمين</p>
              <a routerLink="/admin/reports" class="btn btn-primary">
                <i class="fas fa-arrow-left"></i>
                إدارة البلاغات
              </a>
            </div>
          </div>
        </div>
        
        <!-- Manage Categories -->
        <div class="col-lg-4 col-md-6">
          <div class="quick-action-card categories-action">
            <div class="action-icon">
              <i class="fas fa-tags"></i>
            </div>
            <div class="action-content">
              <h3>إدارة الفئات</h3>
              <p>إدارة فئات الخدمات والتصنيفات في النظام</p>
              <a routerLink="/admin/categories" class="btn btn-primary">
                <i class="fas fa-arrow-left"></i>
                إدارة الفئات
              </a>
            </div>
          </div>
        </div>
    </div>

    <!-- Recent Activity Section -->
    <div class="row mt-5">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center">
          <h2 class="section-title">
            <i class="fas fa-history"></i>
            النشاطات الأخيرة
          </h2>
          <div class="activity-stats">
            <span class="badge bg-primary me-2">
              <i class="fas fa-clock me-1"></i>
              آخر 12 ساعة
            </span>
            <span class="badge bg-success me-2">
              <i class="fas fa-list me-1"></i>
              {{ activitiesData?.totalCount || 0 }} نشاط
            </span>
            <button class="btn btn-outline-primary btn-sm" (click)="refreshActivities()" [disabled]="isRefreshing">
              <i class="fas fa-sync-alt me-1" [class.fa-spin]="isRefreshing"></i>
              {{ isRefreshing ? 'جاري التحديث...' : 'تحديث' }}
            </button>
        </div>
        <p class="text-muted small">
          <i class="fas fa-info-circle me-1"></i>
          آخر تحديث: {{ activitiesData?.reportGeneratedAt ? (activitiesData?.reportGeneratedAt | date:'medium') : 'غير متوفر' }}
          <span class="ms-2" *ngIf="lastRefreshTime">
            <i class="fas fa-sync-alt me-1"></i>
            آخر تحديث محلي: {{ lastRefreshTime | date:'shortTime' }}
          </span>
        </p>
      </div>
    </div>

    <div class="row">
      <div class="col-12">
        <div class="recent-activity-card">
          <div class="activity-list" *ngIf="recentActivities.length > 0; else noActivities">
            <div class="activity-item" *ngFor="let activity of recentActivities; let i = index">
              <div class="activity-icon" [ngClass]="getActivityIconClass(activity.entityType)">
                <i [class]="getActivityIcon(activity.entityType)"></i>
              </div>
              <div class="activity-content">
                <div class="activity-header">
                  <span class="activity-type-badge" [ngClass]="getActivityTypeClass(activity.activityType)">
                    {{ getActivityTypeText(activity.activityType) }}
                  </span>
                  <span class="activity-time">{{ activity.timeAgo }}</span>
                </div>
                <p class="activity-text">{{ activity.description }}</p>
                <small class="activity-meta text-muted">
                  <i class="fas fa-tag me-1"></i>
                  {{ getEntityTypeText(activity.entityType) }}
                  <span class="ms-2">#{{ activity.entityId }}</span>
                </small>
              </div>
            </div>
          </div>
          
          <ng-template #noActivities>
            <div class="no-activities">
              <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
              <p class="text-muted">لا توجد نشاطات في آخر 12 ساعة</p>
            </div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="loading-spinner">
      <i class="fas fa-spinner fa-spin"></i>
      <p>جاري تحميل البيانات...</p>
    </div>
  </div>
</div>

