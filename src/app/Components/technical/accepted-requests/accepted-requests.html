<div class="accepted-requests-container" dir="rtl">
  <!-- Header Section -->
  <div class="header-section">
    <div class="header-content">
      <h1 class="page-title">
        <i class="fas fa-check-circle"></i>
        الطلبات المقبولة
      </h1>
      <p class="page-subtitle">
        عرض الطلبات التي تم قبولها والموافقة عليها
      </p>
    </div>
  </div>

  <!-- Loading State -->
  @if (loading) {
    <div class="loading-container">
      <div class="loading-spinner">
        <i class="fas fa-spinner fa-spin"></i>
      </div>
      <p>جاري تحميل الطلبات المقبولة...</p>
    </div>
  }

  <!-- Error State -->
  @if (error) {
    <div class="error-container">
      <div class="error-icon">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <h3>حدث خطأ</h3>
      <p>{{ error }}</p>
      <button class="btn btn-retry" (click)="loadAcceptedRequests()">
        <i class="fas fa-redo"></i>
        إعادة المحاولة
      </button>
    </div>
  }

  <!-- No Requests State -->
  @if (!loading && !error && acceptedRequests.length === 0) {
    <div class="no-requests-container">
      <div class="no-requests-icon">
        <i class="fas fa-inbox"></i>
      </div>
      <h3>لا توجد طلبات مقبولة</h3>
      <p>لم يتم قبول أي طلبات بعد. ستظهر هنا الطلبات المقبولة فور الموافقة عليها.</p>
    </div>
  }

  <!-- Accepted Requests List -->
  @if (!loading && !error && acceptedRequests.length > 0) {
    <div class="requests-section">
      <div class="requests-header">
        <h2 class="section-title">
          <i class="fas fa-list-check"></i>
          الطلبات المقبولة ({{ acceptedRequests.length }})
        </h2>
        <div class="requests-summary">
          <!-- <span class="summary-item">
            <i class="fas fa-clock"></i>
            في الانتظار: {{ getPendingRequestsCount() }}
          </span> -->
          <span class="summary-item">
            <i class="fas fa-tools"></i>
            قيد التنفيذ: {{ getPendingRequestsCount() }}
          </span>
          <!-- <span class="summary-item">
            <i class="fas fa-check"></i>
            مكتملة: {{ getCompletedRequestsCount() }}
          </span> -->
        </div>
      </div>

      <div class="requests-grid">
        @for (request of acceptedRequests; track request.requestId) {
          <div class="request-card">
            <div class="request-header">
              <div class="client-info">
                <img
                  [src]="request.faceImageUrl"
                  class="client-avatar"
                  alt="صورة العميل"

                />
                <div class="client-details">
                  <h4 class="client-name">{{ request.carOwnerName }}</h4>
                  <!-- <span class="request-id">طلب رقم: {{ request.carOwnerId }}</span> -->
                  <span class="request-category">{{ request.category }}</span>

                </div>
              </div>
              <div class="request-status">
                <span class="status-badge" [ngClass]="getStatusClass(request.requestState)">
                  {{ getRequestStatusText(request.requestState) }}
                </span>
              </div>
            </div>

            <div class="request-body">
              <div class="request-description">
                <h5>وصف المشكلة:</h5>
                <p>{{ request.description }}</p>
              </div>

              <div class="request-meta">
                <div class="meta-item">
                  <i class="fas fa-calendar-alt"></i>
                  <!-- <span>تاريخ القبول: {{ formatTimestamp(request.timeStamp) }}</span> -->
                  <span> تاريخ الإبلاغ: {{request.timeStamp| date:'dd/MM/yyyy' }}</span>


                </div>
                <!-- @if (request.endTimeStamp) {
                  <div class="meta-item">
                    <i class="fas fa-calendar-check"></i>
                    <span>تاريخ الانتهاء: {{ formatTimestamp(request.endTimeStamp) }}</span>
                    <span>تاريخ الانتهاء: {{request.endTimeStamp }}</span>


                  </div>
                } -->

                <!-- <div class="meta-item">
                  <i class="fas fa-user-cog"></i>
                  <span>معرف الفني: {{ request.technicianId }}</span>
                </div> -->
              </div>
            </div>

            <div class="request-actions">
              <button
                class="btn btn-view-details"
                (click)="navigateToRequestDetails(request)"
              >
                <i class="fas fa-eye"></i>
                عرض التفاصيل
              </button>

              <!-- @if (request.requestState === 1) {
                <button class="btn btn-start-work">
                  <i class="fas fa-play"></i>
                  بدء العمل
                </button>
              } -->

              <!-- @if (request.requestState === 2) {
                <button class="btn btn-complete">
                  <i class="fas fa-check"></i>
                  إكمال العمل
                </button>
              } -->
            </div>
          </div>
        }
      </div>
    </div>
  }

  <!-- Quick Stats -->
  @if (!loading && !error && acceptedRequests.length > 0) {
    <div class="stats-section">
      <h2 class="section-title">
        <i class="fas fa-chart-bar"></i>
        إحصائيات سريعة
      </h2>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon pending">
            <i class="fas fa-clock"></i>
          </div>
          <div class="stat-content">
            <h3>في الانتظار</h3>
            <p class="stat-number">{{ getPendingRequestsCount() }}</p>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon in-progress">
            <i class="fas fa-tools"></i>
          </div>
          <div class="stat-content">
            <h3>قيد التنفيذ</h3>
            <!-- <p class="stat-number">{{ getInProgressRequestsCount() }}</p> -->
             <p class="stat-number">{{ getPendingRequestsCount() }}</p>

          </div>
        </div>

        <!-- <div class="stat-card">
          <div class="stat-icon completed">
            <i class="fas fa-check-circle"></i>
          </div>
          <div class="stat-content">
            <h3>مكتملة</h3>
            <p class="stat-number">{{ getCompletedRequestsCount() }}</p>

          </div>
        </div> -->

        <!-- <div class="stat-card">
          <div class="stat-icon total">
            <i class="fas fa-list"></i>
          </div>
          <div class="stat-content">
            <h3>إجمالي الطلبات</h3>
            <p class="stat-number">{{ getTotalRequestsCount() }}</p>
          </div>
        </div> -->
      </div>
    </div>
  }
</div>
